%!TEX root = ../main.tex
\chapter{Literature Review}\label{chapter:literature_review}
To the best of our knowledge there has not been any research on finding the behavioral interaction between the malware families.
There are some anecdotal evidence with some blogs but not any systematic research proving that the change in behavior of a malware on the presence of another do exist.
However, there has been some work on clustering the malware with regard to its behavior. We will discuss in detail about it later.\\
\section{Malware Families}
\label{sec:Malware Families}
We have already discussed about Malware and its types in previous Chapter. Let us look at some of the famous widely spread malware families.\\
\subsection{Conficker}
\label{sub:Conficker}
\textbf{Conficker} is a computer \emph{worm} that targets the \emph{Microsfot Windows} Operating system which was first found in November 2008.
According to \emph{Microsoft}~\cite[Worm:Win32/Conficker.B]{conficker} the detection of \emph{Confiker} worm increased by more that 225 percent since start of 2009.
It is capable of infecting and spreading across network without any human interaction.
It exploits weak password use by trying some common passwords,in order to drop a copy of itself in a network share directory, if current user does not has admin privilege.\\
The worm first tries to copy itself in the Windows system folder as a hidden DLL using some random name. When unsuccessful it tries to copy in \emph{\%ProgramFiles\%} directory.
In order to run on startup, every time the Window boots, it also changes the registry as in~\autoref{lst:confikerregistry}.
\begin{lstlisting}[language=TeX,caption={Registry key created by Confiker worm for autostart},label={lst:confikerregistry}]
In subkey: HKCU\Software\Microsoft\Windows\CurrentVersion\Run
Sets value: "<random string>"
With data: "rundll32.exe <system folder>\<malware file name>.dll,<malware parameters>"
\end{lstlisting}
Not only that it can load itself as service whenever \emph{netsvcs} group is loaded by system \emph{svchost.exe},
it is also capable of loading itself as fake service under \url{`HKLM\\SYSTEM\\CurrentControlSet\\Services'}.
\subsection{Zeus}
\label{sub:Zeus}
\textbf{Zeus} is another malware of \emph{trojan} type, that affects the \emph{Microsoft Windows} Operating System, that attempts to steal confidential information once it infects the victim's machine.
The information may include systems information, banking details, or online credentials of the compromised machine.
It is also capable of downloading configuration files and updates from the Internet. Attacker can used this to change the function of Trojan to change the target value. The Trojan is generated by a toolkit which is also available in underground criminal market, and distribute itself by spam,phising and drive-by downloads.~\cite[Trojan.Zbot]{zeus}.\\
Zeus tries to create a copy of itself as any of the names as \emph{ntos.exe, sdra64.exe,twex.exe} in the \textit{<system folder>}.
In order to make itself run every time the system starts it changes the registry as in~\autoref{lst:zeusregistry}~\cite[Win32/Zbot]{zeusmicro}.
\begin{lstlisting}[language=TeX,caption={Registry key modified by Zeus Trojan to autostart},label={lst:zeusregistry}]
In subkey: HKLM\Software\Microsoft\Windows NT\Currentversion\Winlogon
Sets value: "userinit"
With data: "<system folder>\userinit.exe,<system folder>\<malwar"
\end{lstlisting}
\subsection{Sality}
\label{sub:Sality}
\textbf{Sality} is a family of polymorphic malware that infects files on \emph{Microsfot Windows} system with extensions \emph{.EXE} or \emph{.SCR}.
It spreads by infecting executatble files and replicating itself across network shares.
Each infected host becomes the part of peer to peer network used to propagate the malware~\cite[Sality]{salitysym} \\
\emph{Sality} targets all files in \emph{C:}, and tries to delete files related to anti-virus, stops security related process, and steals sensitive information like cached password and logged keystrokes.
It also changes Windows registry keys in order to lower the computer security.
One of the symptoms to find out if a machine is infected by \emph{Sality} family malware is presence of~\autoref{lst:salityfiles}files in the PC~\cite[Win32/Sality]{salitymicro}.
\begin{lstlisting}[language=TeX,caption={Files created by Sality in the infected machine},label={lst:salityfiles}]
<system folder>\wmdrtc32.dll
<system folder>\wmdrtc32.dl_
\end{lstlisting}
\section{Battle between Malware Families}
\label{sec:Battle between Malware Families}
There has been some evidence of battle between the malware families. We will look upon some of those references in past.
\subsection{Bagle, Netsky, and Mydoom feud}
\label{sub:Bagle, Netsky, and Mydoom feud}
This feud between the malware family dates back to 2004, where there was exchange of words between the creators of \emph{Bagle, Netsky} and \emph{Mydoom}.
The creators inserted their message inside the malware itself, making it visible for the victims too. This also gained much media attention and even appeared in~\cite[BBC]{bbccover}.
Messages like \emph{``dont'r ruine (sic) our business, wanna start a war?''} was seen inside the \emph{Bagle.J}, where as the response message inside \emph{Netsky.F} was \emph{``Bagle \- you are a looser!!!! (sic)''}.
Similar messages with profanity was also seen in variants of \emph{Mydoom.G} families.\\
The reason for the war between these malware families was \emph{Netsky} trying to remove the other two malware \emph{Bagle} and \emph{MyDoom} from the victim's machine.
The creator of \emph{Netsky}, \emph{Sven Jaschan}, also seems to admit that he had written the malware in order to remove infection with \emph{Mydoom} and \emph{Bagle} worms from victim's computer~\cite[]{wikinetsky}.\\
All three malware family were computer worms spreading through email as an attachment and making victim curious enough to download and open it.
\subsection{Kill Zeus}
\label{sub:Kill Zeus}
This was another war between the two \emph{Trojan} malware families \emph{Spy Eye} and \emph{Zeus}.
\emph{SpyEye} is a malware which like \emph{Zeus} was created specifically to facilitate online theft from the financial institutions, especially targeting U.S.
It infected roughly 1.4 million computers, mainly located in U.S, and got the personal identification informations and financial informations of victim in order to transfer money out of victim bank accounts~\cite[]{fbispyeye} \\
\textbf{SpyEye} came with the feature called \emph{Kill Zeus} that was successful in removing large varieties of \emph{Zeus} family.
The battle between these two family was pretty much dynamic and many releases of the Trojan toolkit were made from both the family in order to negate each others affect~\cite[]{sanszeus}.
\subsection{Shifu}
\label{sub:Shifu}
This highly evasive malware family, \textbf{Shifu}, targeting mainly Japanese (82\%), Austria-Germany (12\%), and mix Europe (6\%) banks for sensitive data, was detected recently in the year 2015~\cite[]{secintelshifu}.
It uses \emph{Domain Name Generation} to generated random domain names for covert botnet communication.
It terminates itself it it finds that it is being run inside a virtual machine or is being debugged, which it finds out by checking system files such as \emph{pos.exe, vmmouse.sys, sanboxstarter.exe} or \emph{IsDebuggerPresent} API~\cite[]{mccafeshifu}.\\
\emph{Shifu} had antivirus kind of feature that prevented any other malware from infecting its victim by stopping the installation or making the file look suspicious.
It kept the track of all the files being downloaded by hooking \textit{URLDownloadToFile}\footnote{Downloads bit from Internet.\ \url{https://msdn.microsoft.com/en-us/library/ms775123\%28v=vs.85\%29.aspx}} function.
For any unsigned executables coming from unsecure network it renamed the file to \emph{infected.exx} and also send the copy of file to its \emph{C\&C} server, probably for further analysis.
\emph{Shifu} did not find or delete if the system is prior affected by other malware, but once it had the control of victim's, it managed to stop infection from further malware or any updates to the existing malware by disconnecting it with its botmaster~\cite[]{secintelshifu}.
\section{Malware Analysis}
\label{sec:Malware Analysis}
\emph{Malware Analysis} is a process of dissecting different components of a malware in order to study the behavior of the malware when it infects a host or victim's machine. It is done using different analysis tools and reverse engineering the binary.
There are usually two types of malware analysis system, \emph{Static} and \emph{Dynamic}.\\
\textbf{Static Anaylsis} studies the binary by disassembling it with use of disassembler, decompilers, source code analyzers to find the control flow graph of all the code segment and path that the program might take under different given conditions.
The analysis is done without running the program, but studying the assembly code of binary to detect the benign or malicious nature of program.
\emph{Static analysis} gives all the possible behavior of program but for large number of huge programs it is hard and time consuming.
\textbf{Dynamic Analysis} is done by running the binary in a closed controlled system such as \emph{Virtual Box} or \emph{Sandbox} and logging all the activities of the malware while it runs in host.
\emph{Dynamic analysis} is faster than static analysis and gives clear insight of the program behavior and nature.
However it might not be feasible to traverse all the execution path that a program might take.
\\
With the increase in the rate of new malware with polymorphic and metamorphic nature, it has become much difficult to detect a new malware from \emph{static analysis}.
The syntactic signatures are ignorant of the semantics of the instruction and can be easily evaded with code obfuscation and making program control flow obscure~\cite[]{staticlimit}.\\
Also, many environment sensitive malware evade the \emph{dynamic analysis} by changing their behavior, and not performing any malicious activities, once they find out they are being run inside analysis environment.
This makes detection of evasive malware much more manual process~\cite[]{barecloud}.

\section{Malware Clustering}
\label{sec:Malware Clustering}
With the advent of dynamic analysis of malware, there has also been rise in different approach to build a system that could analyze the malware in large numbers.
New malware are on the rise at an exponential rate with millions of them being introduced each day.
Malware authors use polymorphic and metamorphic techniques to make malware more complex and change it's form so as to make traditional signature based detection hard to detect them.
Even dynamic analysis required manual inspection because of diversity in malware variants and its rapid increase.
A good clustering system would be able to detect the similarity between malware to find if the new binary is a variant of previous malware and classify them accordingly.
There have been many approaches to use automated malware clustering in order to classify binaries based on their behavioral similarity.
This can be used to analyze any new binary to find out if it's novel or similar to previously known malware.\\
Let us discuss about some previous works done with classification of malware based on the behavioral activities of malware.\\
\citeauthor{bayer} used execution traces of malware in order to create a behavioral profile which they later used as an input to their clustering algorithm.
This was the first approach to use clustering of malware on a large scale.
Their system was able to recognize and group similar malware with better precision and scalable manner.
About 75 thousands malware were clustered within three hours.\\
\citeauthor{autoana} also used clustering and classification using \emph{machine learning} to analyze behavior of malware.
Their work was inspired by~\cite[]{bayer} and used incremental approach to decrease the runtime overhead, as malware were processed in a daily basis with batch of 1000~\cite[]{autoana}.\\
\citeauthor{firma} developed \emph{FIRMA}, a tool that clusters the malware binary into families, based on the network traffic of unlabeled malware binaries.
It also produces network signature for each of the network behavior of family.
The tool was evaluated against the datasets of \emph{16,000} unique malware binaries~\cite[]{firma}.
\citeauthor{pirscoveanu} also presented a system to analyze and classify high amount of malware in a scalable and automatized manner, which could be used pre-filter novel from known malware.
They used~\cite[Cuckoo]{cuckoo} to generate behavioral profile of a malware and \emph{Random Forest} for \emph{supevised} machine learning.
The total number of samples used for experiment were \emph{42,068}, out of which $67\%$ were used for training and remaining $33\%$ were used as testing set~\cite[]{pirscoveanu}.\\
\citeauthor{yavvari} uses behavioral mapping approach to find the commonalities between malware behavior grouped component wise.
They define the term ``soft cluster'' which represents malware relationship with respect to all behavioral similarities, however small.
Using soft clustering approach they revealed component sharing that belonged to different families according to traditional grouping.
The system was evaluated on the set of \emph{1,727} unique malware samples~\cite[]{yavvari}.
\citeauthor{firdausi} in their paper performed different classification using different classifiers, \emph{k-Nearest Neighbor, Naive Bayer, J48 decision trees, Support Vector Machine, and Multilayer Perception Neural Network}, to classify the malware based on behavioral data.
They conclude that machine learning techniques based on behavioral profile could detect malware quite efficiently and effectively~\cite[]{firdausi}.\\
\\
We too will also be using machine learning techniques in our research to cluster the malware, based on the behavioral profiles generated from dynamic analysis, to classify malware into different probable families.
We believe in the notion that malware belonging to same families will have similar behavioral activities, thus more common resource activity.
The work done on clustering so far has been done on smaller set of thousands of malware as described above.
We use unsupervised machine learning algorithm to perform the clustering of those malware on very large data set of millions of malware.
We will discuss in details what we chose for clustering and we perform it in \autoref{sec:Topic model}.
% Different AV companies have been trying to label the malware with their own labeling system.
% But, there has not been a common standard for this leading to inconsistency as they use different approach for classification.
% A binary which might be labeled as malware may be labeled benign by another AV, or might be labeled as belonging to different family.
% There is not consistency between the labeling of malware and also because of this Virus Total labeling is not considered a good parameter.
