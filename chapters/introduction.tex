\chapter{Introduction}\label{chapter:introduction}
Malware, short for malicious software, is a generic term referring to all kinds of software that poses threat of causing damage, disrupt, steal or some other illegitimate action, on computer, server, or computer network.
Malware can infect the system by being bundled with some other program or being attached as macros in the file.
When the user runs or opens such program or file, the malware gets installed into the user's machine.
They can also install themselves by exploiting some common vulnerabilities in Operating System (OS), network devices, or other common software.
The vast majority is installed by some action from user, such as clicking an e-mail attachment or downloading a file from Internet~\cite[]{ciscodif}.\\
% Malware can be classified into self-replicating and non-replicating categories.
% Viruses and Worms, which are the two most common types of malware, fall under the self-replicating, where as Trojans and Bots are categorized under non-replicating.\\
Some of the commonly known malware types are viruses, worms, Trojans, and bots.
\textbf{Virus} is a piece of malicious code attached to some other executable host program or file, which gets executed when the user runs the host program.
It can replicate itself to form multiple copies but cannot propagate on its own.
It spreads when it is transferred or copied, by the user, to another computer via the network, file sharing or as an email attachment.\\
\textbf{Worm}, unlike virus, is capable to run independently and is self-propagating.
It propagates by exploiting some vulnerability in machine OS, device drivers or taking the advantage of file-transfer features, such as email or network share.\\
\textbf{Trojan} are non-replicating malware which gets its name from ancient Greek story \textit{Trojan Horse}.
It is a software that looks legitimate, but is harmful in disguise, which usually spreads through user interaction such as Internet downloads and email attachments.\\
\textbf{Bot}, is a word derived from \emph{``robot''}, which is capable of performing automated tasks.
The host machine infected by a bot can be accessed remotely by its author,also called \emph{``botmaster''}, and give any commands.
The botmaster does this from a central server called the Command and Control (C\&C) server.
A network of such many Internet-connected bot is called \textbf{Botnet}.
A bot is capable of logging keystroke, gather passwords, and financial information, and send it to C\&C server.
Bot can also be used to launch \emph{Distributed Denial of Service (DDoS)} attack, by flooding single server, with many requests or sending spam in large scale.\\
Some malware are able to change its structure and create a new variant of itself each time it infects new victim.
On the basis of how the malware changes its structure, it can be broadly divided into Polymorphic and Metamorphic malware.
\textbf{Polymorphic} malware divides its program into two section of code, decryptor and encryptor.
The first code section, decryptor, decrypts the second section of the code and hands the execution control to the decrypted section of code.
When the second section of code (encryptor) executes, it creates a new decryptor to encrypt itself, and links the new encrypted code section (encryptor) and decryptor to construct a new variant of malware.
Code obfuscation techniques (e.g.\ dead-code insertion, subroutine reordering, instruction substitution) are used to mutate the decryptor to build the new one for new infected victim~\cite[]{rad2011evolution}.
\textbf{Metamorphic} malware are body-polymorphic malware, i.e., instead of generating new decryptor, a new instance is created using same techniques as used in polymorphic malware.
Unlike Polymorphic malware, it has no encrypted part~\cite[]{rad2012camouflage}.
In both cases the new variants may have different syntactic properties, but the real behavior of the malware remains same.\\

As the Internet increased its penetration over the last two decade, more and more devices are being connected via Internet.
Many of our daily life activities are now depended on its usage, such as email, banking, bill payment, and social network.
Along with this, the underground Internet economy has also been on the rise.
Malware authors now do not write malware just for fun, to create annoyance or break into some system as bragging rights, but also for profit generation.
Malware authors look for banking credentials, Credit cards, personal informations and identifications that they can gather and sell in underground market.
In 2006, annual losses caused by malware were estimated to be 2.8 billion dollars in United States and 9.3 billion euros in Europe~\cite[]{moore2009economics}.
Driven by the high profit and rise in easily available tools to create polymorphic and metamorphic malware, there has been rapid increase in the number of new malware being introduced each day~\cite[]{tian}.
According to \emph{AV-Test}, an independent IT-Security Institute based on Germany, about 140 million new malware were introduced in year 2015 alone, making the total number of malware recorded so far to almost half a billion~\cite[]{avtest}.
\\
%TODO: add graph
With the increase in numbers of malware as it has become a lucrative business, malware authors are vying with each other to take sole control of the their victim for larger profit.
Many cases have been found in the past, where one malware try to delete another malware from the victim's machine.
Further, once they have infected the victim, they prevent the host from being infected by other malware.
In 2010, \emph{SpyEye}, a Trojan, was found to have a feature \emph{KillZeus} that would remove \emph{Zeus}, which is also another Trojan, making \emph{SpyEye} the only malware to run in the compromised system.
In 2015, \emph{Shifu}, a banking Trojan, was found to have behavior similar to Anti Virus (AV), i.e., preventing the host from further infection by other malware, once it had taken control over the victim's machine.
We have discussed in details, about such anecdotal findings of interaction between malware families, in \autoref{sec:Interference between Malware Families}.\\
The study of aforementioned behavioral interference between the malware family will provide a novel knowledge to understand dynamic aspect of modern malware and the inter family relations.
This behavior is also a case for environment-sensitive malware, where malware change its behavior dependent on different factors in the environment it is running.
To our best knowledge, there hasn't been such study so far.
We present a systematic way to find out such interferences from large number of malware samples.\\
Our dataset consists of {\gettotalmalwarei{}} malware samples, collected by \emph{Anubis}~\cite[]{anubis}, a dynamic full-system-emulation-based malware analysis environment, over time from its public web interface and a number of feeds from security organizations.
Detailed discussion on \emph{Anubis} and malware analysis is done in~\autoref{sec:Malware Analysis}.
Randomly picking a malware pair to analyze from the available dataset would not be good approach, whereas running all the possible pairs of millions of malware is not scalable too.
We needed to decrease our data set in a way such that we do not loose possible candidates exhibiting behavioral interference.
In order to minimize our search space for candidate selection, and maximize the probability for finding pair with behavioral interference, we take into account only those malware which would create a resource successfully and another malware that tries to access or delete that same resource, but with failure.
\textbf{Resource} refers to any entity, such as Files, Registry, Section, Sync, that can be modified or queries by malware using system calls.
Since, \emph{Anubis}, emulates Windows OS, \textbf{system calls} refers to Windows Application Programming Interface (API) functions.
The trace of all the resource modified or queried by a malware during its execution is called \textbf{Behavioral Profile} of that malware.
In \autoref{sec:Behavioral Profile} and \autoref{sec:Resource Types} we define behavioral profiles and different resource types in details.
If a malware makes a failed attempt to access or delete resource created by another malware, there should be some interaction between those malware.
It is trying to detect the presence of other files or registry in the environment it is currently running, and its behavior is affected by the positive or negative result.
This shows the dynamic aspect of malware behavior and its environment-sensitive nature.\\
The simple heuristic of finding candidate based on common resource did not give us good result, as the number of malware were still too many to select candidate pairs.
In order to further filter the dataset, we used clustering of malware based on behavioral profile.
Clustering of malware based on behavioral profile has been used extensively in previous works which we have listed in details in \autoref{sec:Behavioral Clustering}.
With clustering we grouped malware into different clusters, each cluster represented as family and similar behaving malware into falling into same cluster.
We choose final candidate pairs and run them together based on heuristics described in~\autoref{sec:Running Experiment}.
An unpacker was build in order to run the candidate pairs in the \emph{Anubis} system for analysis.
\textbf{Unpacker} drops the candidate pair in the analysis system, and executes both malware, one after another, with a time interval between.
We were able to successfully find X pair of malware with interfering behavior with a true positive rate of X.\\
Our research will provide following contributions:
\begin{itemize}
  \item A better understanding of dynamic behavior of malware.
  \item An automated system that detects competing malware samples in large scale.
  \item A novel approach to clustering large number of malware with respect to their behavior profiles.
  % TODO: number of pairs
\end{itemize}
We discuss about malware families, evidences of interaction between malware families, previous works on the use of clustering of malware based on malware behavior generated from dynamic malware analysis, and motivation for our research work in \autoref{chapter:literature_review}.
Following the motivation, we will give overview, design rationale and technical description of our process and system in \autoref{chapter:methodology}.
In \autoref{chapter:implementation}, we show how we implemented the system, problems faced during the implementation, and how we solved them.
We present the findings of our work in \autoref{chapter:results}.
Finally, we conclude with a discussion of our work, and possible improvement in future in \autoref{chapter:conclusion_and_future_work}
